(function(){function u(){NProgress.start();NProgress.set(.8);var n="";var u=$("#search-type").text();console.log(window.location);if(e!=""){console.log("searching"+e);if(u.length<=8){url="/hotel?id="+e;$("li.navlink").removeClass("active");$('a[href="/hotel.html"]').parent().addClass("active")}else{url="/agent?id="+e;$("li.navlink").removeClass("active");$('a[href="/agent.html"]').parent().addClass("active")}t.hide();console.log(url);$(".alert-div").hide();$.getJSON(url,function(o){r=o;console.log(o);n+='<div class="row">';n+='<div class="col-md-6 col-sm-8 col-xs-11 col-lg-6 col-md-offset-3 col-sm-offset-2 col-lg-offset-3">';n+='<ul class="map-ul" style="list-style-type:none">';$.each(o,function(e,t){if(u.length<=8){n+='<li id="list-head" >';n+='<div class="thumbnail card">';n+='<div data-toggle="modal" href="#a'+e+'" class="media" style="cursor:pointer" name='+e+">";n+='<a  class="pull-left">';n+='<img data-src="holder.js/5x100/text: " alt="">';n+="</a>";n+='<div class="media-body">';n+='<h2 class="media-heading" id="list-heading">'+t.name+"</h2>";n+="<address>";n+='<p><i class="glyphicon glyphicon-map-marker text-success"></i> '+t.city+", "+t.state+"</p>";n+='<p><i class="glyphicon glyphicon-phone  text-info"></i>'+t.phone+" ";n+='<span class="pull-right"><i class="glyphicon glyphicon-tag text-warning"></i> '+t.type+"</span></p> ";n+="</address>";n+="</div>";n+="</div>";n+="</div>";n+='<div class="modal fade" id=a'+e+' tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">';n+='<div class="modal-dialog">';n+='<div class="modal-content">';n+='<div class="modal-header">';n+='<button type="button" class="close" name=a'+e+' data-dismiss="modal" aria-hidden="true">×</button>';n+='<div class="media" >';n+='<div class="media-body">';n+='<h2 class="media-heading" id="list-heading">'+t.name+"</h2>";n+="<address>";n+='<p><i class="glyphicon glyphicon-map-marker  text-success"></i><small> '+t.address+"</small></p>";n+="</address>";n+="</div>";n+="</div>";n+="</div>";n+='<div class="progress progress-striped active status'+e+'">';n+="<div id=status"+e+' class="progress-bar progress-bar-warning " role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">loading map...';n+="</div>";n+="</div>";n+='<div class="modal-body">';n+="<div class='thumbnail'>";n+="<div id='map"+e+"' class='thumbnail' style='height:250px'>";n+="</div>";n+="</div>";n+="<hr/>";n+='<div class="row ">';n+='<div class="col-sm-6">';n+='<div class="panel panel-info"><div class="panel-heading">Hotel Details</div>';n+='<ul class="list-group">';n+='<a class="list-group-item"><abbr title="Phone"><i class="glyphicon glyphicon-phone  text-danger"></i></abbr><small> '+t.phone+"</small></a>";n+='<a class="list-group-item"><abbr title="Fax"><i class="glyphicon glyphicon-folder-open  text-danger"></i></abbr><small> '+t.fax+"</small></a>";n+='<a href="mailto:'+t.email+'" class="list-group-item"><abbr title="Email"><i class="glyphicon glyphicon-envelope  text-danger"></i></abbr><small> '+t.email+"</small></a>";n+='<a href="https://'+t.website+'" target="_blank" class="list-group-item"><abbr title="website"><i class="glyphicon glyphicon-globe  text-danger"></i></abbr><small> '+t.website+"</small></a>";n+='<a class="list-group-item"><abbr title="Type"><i class="glyphicon glyphicon-tag  text-danger"></i></abbr><small> '+t.type+"</small></a>";n+='<a class="list-group-item"><abbr title="rooms"><i class="glyphicon glyphicon-glass  text-danger"></i></abbr><small> '+t.room+"rooms</small></a>";n+="</ul>";n+="</div>";n+="</div>";n+='<div class="col-sm-6">';n+='<div class="panel panel-info "><div class="panel-heading">Photos</div>';n+='<ul class="rslides" id=photos'+e+"></ul>";n+="</div>";n+="</div>";n+="</div>";n+="</div>";n+="</div>";n+="</div>";n+="</li>"}else{n+='<li  id="list-head" >';n+='<div class="thumbnail card">';n+='<div data-toggle="modal" href="#a'+e+'" class="media" style="cursor:pointer" name='+e+">";n+='<a  class="pull-left">';n+='<img data-src="holder.js/5x100/industrial/text: " alt="">';n+="</a>";n+='<div class="media-body">';n+='<h3 class="media-heading" id="agent-list-heading" >'+t.name+"</h3>";n+="<address>";n+='<small><p><i class="glyphicon glyphicon-map-marker text-success"></i> '+t.address+", "+t.state+"</p>";n+='<p><i class="glyphicon glyphicon-phone text-info"></i> '+t.phone+" ";n+='<span class="pull-right"><i class="glyphicon glyphicon-tag text-warning"></i> '+t.type+"</span></p> </small>";n+="</address>";n+="</div>";n+="</div>";n+="</div>";n+='<div class="modal fade" id=a'+e+' tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">';n+='<div class="modal-dialog">';n+='<div class="modal-content">';n+='<div class="modal-header">';n+='<button type="button" class="close" name=a'+e+' data-dismiss="modal" aria-hidden="true">×</button>';n+='<div class="media" >';n+='<div class="media-body">';n+='<h2 class="media-heading" id="list-heading">'+t.name+"</h2>";n+="<address>";n+='<p><i class="glyphicon glyphicon-map-marker text-success"></i><small> '+t.address+"</small></p>";n+="</address>";n+="</div>";n+="</div>";n+="</div>";n+='<div class="modal-body">';n+='<div class="panel panel-info"><div class="panel-heading">Details</div>';n+='<ul class="list-group">';n+='<a class="list-group-item"><abbr title="city"><i class="glyphicon glyphicon-map-marker text-danger"></i></abbr><small> '+t.city+"</small></a>";n+='<a class="list-group-item"><abbr title="state"><i class="glyphicon glyphicon-map-marker text-danger"></i></abbr><small> '+t.state+"</small></a>";n+='<a class="list-group-item"><abbr title="Type"><i class="glyphicon glyphicon-tag text-danger"></i></abbr><small> '+t.type+"</small></a>";n+='<a class="list-group-item"><abbr title="region"><i class="glyphicon glyphicon-glass text-danger"></i></abbr><small> '+t.region+" region</small></a>";n+="</ul>";n+="</div>";n+='<div class="panel panel-info "><div class="panel-heading">Contact Person</div>';n+='<ul class="list-group">';n+='<a class="list-group-item"><abbr title="Phone"><i class="glyphicon glyphicon-phone text-danger"></i></abbr><small> '+t.phone+"</small></a>";n+='<a class="list-group-item"><abbr title="Fax"><i class="glyphicon glyphicon-folder-open text-danger"></i></abbr><small> '+t.fax+"</small></a>";n+='<a href="mailto:'+t.email+'" class="list-group-item"><abbr title="Email"><i class="glyphicon glyphicon-envelope text-danger"></i></abbr><small> '+t.email+"</small></a>";n+="</ul>";n+="</div>";n+="</div>";n+="</div>";n+="</div>";n+="</li>"}});n+="</ul>";n+="</div>";n+="</div>";NProgress.done();$("#maintext").hide();$("#maininfo").hide();$(".hotel-list").html(n);$("#navbar").show();$(".target").val(e);t.show();$("dd").hide();Holder.run();$(document).on("appear",".card",function(e){console.log("appered");$(this).addClass("appeared")});$(".card").appear({force_process:true});if(s){i.target=e;i.text=u;console.log("url_obj");console.log(i);window.history.pushState(i,e,"/search/"+e)}s=true}).fail(function(){NProgress.done();$(".alert-text").html('<strong><i class="glyphicon glyphicon-exclamation-sign"></i> Opps</strong> Nothing found, try searching for other terms.');$(".alert-div").show()})}else{$(".alert-text").html("<strong>Opps!</strong> search is empty.");$(".alert-div").show();NProgress.done()}o=false}function p(){a=new google.maps.Geocoder;var e=new google.maps.LatLng(-34.397,150.644);var t={zoom:18,mapTypeId:google.maps.MapTypeId.ROADMAP};f=new google.maps.Map(document.getElementById("map"+l),t);console.log("initialising map--------------")}function m(e,t){p();console.log(e+","+t);var n=new google.maps.LatLng(-33.8665433,151.1956316);console.log(status);var r={location:n,radius:"500",query:e+","+t};h=new google.maps.places.PlacesService(f);h.textSearch(r,g)}function g(e,t){if(t==google.maps.places.PlacesServiceStatus.OK){$("#status"+l).width("100%");b(e[0]);console.log("found : "+e[0]);console.log("success :"+t);f.setCenter(e[0].geometry.location);var n={reference:e[0].reference};h.getDetails(n,y);$(".status"+l).hide()}else{$("#status"+l).width("90%");console.log(t);if(d++<2){a.geocode({address:r[l].address},function(e,t){if(t==google.maps.GeocoderStatus.OK){console.log(e[0].geometry.location);var n=e[0].geometry.location;console.log(t);console.log(e[0]);var i={location:n,radius:"500",query:r[l].name};h=new google.maps.places.PlacesService(f);h.textSearch(i,g)}else{$("#status"+l).width("100%");$("#status"+l).text("Sorry, unble to load MAP")}})}}}function y(e,t){if(t==google.maps.places.PlacesServiceStatus.OK){console.log("details: ");console.log(e);var n="#photos"+l;var r=e.photos;if($(n+" > li").length==0){for(var i=0;i<r.length;i++){console.log("inside photos");$(n).append('<li><img src="'+r[i].getUrl({maxWidth:400,maxHeight:300})+'" class="img-responsive list-img" alt="Unable to load image" ></li>')}$(".rslides").responsiveSlides();console.log("image inserted")}}}function b(e){var t=e.geometry.location;var n=new google.maps.Marker({map:f,position:e.geometry.location});var r=new google.maps.InfoWindow;f.setCenter(t);google.maps.event.addListener(n,"click",function(){r.setContent(e.name);r.open(f,this)});console.log("marker created success")}var e=$(".target").val();var t=$("#search");var n=$("input:text");var r;var i={};var s=true;var o=false;$(document).on("click","button.close",function(){var e="#"+$(this).attr("name");$(e).modal("hide")});n.focus(function(e){$(".alert-div").hide()});$("li.navlink").click(function(e){e.preventDefault();var t=$(this).children().attr("href");console.log(t);if(t=="/hotel.html"){$("#search-type").text("Hotels");u()}else if(t=="/agent.html"){$("#search-type").text("Travel Agents");u()}else{$("li.navlink").removeClass("active");$('a[href="/about.html"]').parent().addClass("active");$(".hotel-list").empty();$(".hotel-list").hide();$(".alert-div").hide();$(".hotel-list").load(t+" .about");$(".hotel-list").show();$.stellar({horizontalScrolling:false,verticalOffset:40});i.target="about";i.text="Hotels";window.history.pushState(i,"","/search/"+i.target)}});window.onpopstate=function(t){console.log("onpopstate called");if(t.state){console.log("going back");$("#search-type").text(t.state.text);e=t.state.target;console.log("target: "+e);if(e=="home"){console.log("going home");window.location.href="http://hotelsquare.azurewebsites.net/"}else if(e=="about"){console.log("going to about");$("li.navlink").removeClass("active");$('a[href="/about.html"]').parent().addClass("active");$(".hotel-list").empty();$(".hotel-list").hide();$(".alert-div").hide();$(".hotel-list").load("/about.html .about");$(".hotel-list").show()}else{s=false;u()}}else{if(e==""){console.log("value empty")}else if(e!="about"){console.log("value:");console.log(e);console.log("value not empty");i.target="home";i.text="Hotels";console.log(i);window.history.pushState(i,"","");u()}else if(e=="about"){$("li.navlink").removeClass("active");$('a[href="/about.html"]').parent().addClass("active");$(".hotel-list").empty();$(".hotel-list").hide();$(".alert-div").hide();$(".hotel-list").load("/about.html .about");$(".hotel-list").show();$.stellar({horizontalScrolling:false,verticalOffset:40});i.target="about";i.text="Hotels";window.history.pushState(i,"","/search/"+i.target)}}};$(".search-select").click(function(e){e.preventDefault();if($(this).text()==="Search Hotel"){$("#search-type").html('Hotels <span class="caret"></span>')}else{$("#search-type").html('Travel Agents <span class="caret"></span>')}});n.change(function(){console.log("text changed ");$(".target").val($(this).val());e=$(this).val();if(o==true){u()}});n.keydown(function(e){var t=e.keyCode;console.log("KeyCode: "+t);if(t==13){console.log("keycode enter pressed");o=true}});$(".search-button").click(function(){console.log("button clicked");u()});jQuery(".typeahead").on("typeahead:selected",function(t,n){e=n.value;console.log("typeahead pressed: "+e);u()});$(".typeahead").typeahead([{name:"city",prefetch:"../json/city.json",ttl:0,limit:5},{name:"hotel",prefetch:"../json/hotellist.json",ttl:0},{name:"state",prefetch:"../json/state.json",ttl:0}]);var a;var f;var l;var c;$(document).on("click","div.media",function(e){l=parseInt($(this).attr("name"));c="#a"+l});$(document).on("hidden.bs.modal",c,function(e){$("#status"+l).text("loading map...");$("#status"+l).width("0%");$(".status"+l).show(200)});$(document).on("shown.bs.modal",c,function(e){console.log("loading map--------------");$("#status"+l).width("80%");d=0;m(r[l].name,r[l].address)});var h;var d=0;var v="";})()